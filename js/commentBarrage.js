var post_comment=document.getElementById("post-comment");if(null!=post_comment){const e={lightColors:[["var(--lyx-white-acrylic2)","var(--lyx-black)"]],darkColors:[["var(--liusiqi-maskbgdeep)","var(--lyx-white)"]],maxBarrage:1,barrageTime:5e3,twikooUrl:"http://tcb-api.tencentcloudapi.com/web?env=twikoo-8g1k9ktsad0f53fa",accessToken:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJkYXRhIjoie1wibG9naW5UeXBlXCI6XCJDVVNUT01cIixcImVudk5hbWVcIjpcInR3aWtvby04ZzFrOWt0c2FkMGY1M2ZhXCIsXCJ1dWlkXCI6XCI5NDY5ZjcwNzJkMDk0NmI1OWEyN2YyYzE5ODE0OWViZVwiLFwiY3VzdG9tVXNlcklkXCI6XCJhZG1pblwifSIsImlhdCI6MTY2NTIyNjEzNSwiZXhwIjoxNjY1MjI5NzM1fQ.Ud6MMXMpmkXgHJucZXug0xnDBV22NaJ-a3BBv2zcjiw;1665212940",pageUrl:window.location.pathname,barrageTimer:[],barrageList:[],barrageIndex:0,noAvatarType:"retro",dom:document.querySelector(".comment-barrage"),displayBarrage:!0,avatarCDN:"cravatar.cn"};function isInViewPortOfOne(e){const t=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight;return e.offsetTop-document.documentElement.scrollTop<=t}function initCommentBarrage(){var t=JSON.stringify({env:"twikoo-8g1k9ktsad0f53fa",action:"functions.invokeFunction",function_name:"twikoo",dataVersion:"2020-01-10",request_data:`{"event":"COMMENT_GET","url":"${e.pageUrl}"}`,access_token:e.accessToken,seqId:"454f0d01f2481"}),a=new XMLHttpRequest;a.withCredentials=!0,a.addEventListener("readystatechange",(function(){4===this.readyState&&(console.log(this),e.barrageList=commentLinkFilter(JSON.parse(this.responseText).data||[]),console.log("@@@@,",e.barrageList),null!=e.dom&&(e.dom.innerHTML=""))})),a.open("POST",e.twikooUrl),a.setRequestHeader("Content-Type","application/json"),a.send(t),setInterval((()=>{e.barrageList.length&&(popCommentBarrage(e.barrageList[e.barrageIndex]),e.barrageIndex+=1,e.barrageIndex%=e.barrageList.length),e.barrageTimer.length>(e.barrageList.length>e.maxBarrage?e.maxBarrage:e.barrageList.length)&&removeCommentBarrage(e.barrageTimer.shift())}),e.barrageTime)}function commentLinkFilter(e){console.log(e),e.sort(((e,t)=>e.created-t.created));let t=[];return e.forEach((e=>{t.push(...getCommentReplies(e))})),t}function getCommentReplies(e){if(e.replies){let t=[e];return e.replies.forEach((e=>{t.push(...getCommentReplies(e))})),t}return[]}function popCommentBarrage(t){let a=document.createElement("div");e.dom.clientWidth,e.dom.clientHeight;a.className="comment-barrage-item";let r=Math.floor(Math.random()*e.lightColors.length);document.getElementById("barragesColor").innerHTML=`[data-theme='light'] .comment-barrage-item { background-color:${e.lightColors[r][0]};color:${e.lightColors[r][1]}}[data-theme='dark'] .comment-barrage-item{ background-color:${e.darkColors[r][0]};color:${e.darkColors[r][1]}}`,a.innerHTML=`\n\t\t<div class="barrageHead">\n\t\t\t<img class="barrageAvatar" src="https://${e.avatarCDN}/avatar/${t.mailMd5}?d=${e.noAvatarType}"/>\n\t\t\t<div class="barrageNick">${t.nick}</div>\n\t\t\t<a href="javascript:switchCommentBarrage()" style="font-size:20px">Ã—</a>\n\t\t</div>\n\t\t<div class="barrageContent">${t.comment}</div>\n\t`,e.barrageTimer.push(a),e.dom.append(a)}function removeCommentBarrage(t){t.className="comment-barrage-item out",1!=e.maxBarrage?setTimeout((()=>{e.dom.removeChild(t)}),1e3):e.dom.removeChild(t)}document.onscroll=function(){e.displayBarrage&&(isInViewPortOfOne(post_comment)?document.getElementsByClassName("comment-barrage")[0].setAttribute("style","display:none;"):document.getElementsByClassName("comment-barrage")[0].setAttribute("style",""))},switchCommentBarrage=function(){if(localStorage.setItem("isBarrageToggle",Number(!Number(localStorage.getItem("isBarrageToggle")))),!isInViewPortOfOne(post_comment)){e.displayBarrage=!e.displayBarrage;let t=document.querySelector(".comment-barrage");t&&$(t).fadeToggle()}},$(".comment-barrage").hover((function(){clearInterval(timer)}),(function(){timer=setInterval((()=>{e.barrageList.length&&(popCommentBarrage(e.barrageList[e.barrageIndex]),e.barrageIndex+=1,e.barrageIndex%=e.barrageList.length),e.barrageTimer.length>(e.barrageList.length>e.maxBarrage?e.maxBarrage:e.barrageList.length)&&removeCommentBarrage(e.barrageTimer.shift())}),e.barrageTime)})),null==localStorage.getItem("isBarrageToggle")?localStorage.setItem("isBarrageToggle","0"):"1"==localStorage.getItem("isBarrageToggle")&&(localStorage.setItem("isBarrageToggle","0"),switchCommentBarrage()),initCommentBarrage()}