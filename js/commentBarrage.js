var timer,url_flag=window.location.pathname;window.onload=function(){var e,a,t=document.getElementById("post-comment");if(null!=t&&"/barrage/"!=url_flag){const g={lightColors:[["var(--lyx-white-acrylic2)","var(--lyx-black)"]],darkColors:[["var(--liusiqi-maskbgdeep)","var(--lyx-white)"]],maxBarrage:1,barrageTime:5e3,twikooUrl:"https://twikoo.top",accessToken:"9901a847ec7ab9994996c424e5dbecb0",pageUrl:window.location.pathname,barrageTimer:[],barrageList:[],barrageIndex:0,noAvatarType:"retro",dom:document.querySelector(".comment-barrage"),displayBarrage:!0,avatarCDN:"cravatar.cn"};function r(e){const a=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight;return e.offsetTop-document.documentElement.scrollTop<=a}function n(e){if(e.replies){let a=[e];return e.replies.forEach((e=>{a.push(...n(e))})),a}return[]}function o(e){let a=document.createElement("div");g.dom.clientWidth,g.dom.clientHeight;a.className="comment-barrage-item";let t=Math.floor(Math.random()*g.lightColors.length);document.getElementById("barragesColor").innerHTML=`[data-theme='light'] .comment-barrage-item { background-color:${g.lightColors[t][0]};color:${g.lightColors[t][1]}}[data-theme='dark'] .comment-barrage-item{ background-color:${g.darkColors[t][0]};color:${g.darkColors[t][1]}}`,a.innerHTML=`\n\t\t<div class="barrageHead">\n\t\t\t<img class="barrageAvatar" src="https://${g.avatarCDN}/avatar/${e.mailMd5}?d=${g.noAvatarType}"/>\n\t\t\t<div class="barrageNick">${e.nick}</div>\n\t\t\t<a href="javascript:switchCommentBarrage()" style="font-size:20px">×</a>\n\t\t</div>\n\t\t<div class="barrageContent">${e.comment}</div>\n\t`,g.barrageTimer.push(a),g.dom.append(a)}function l(e){e.className="comment-barrage-item out",1!=g.maxBarrage?setTimeout((()=>{g.dom.removeChild(e)}),1e3):g.dom.removeChild(e)}document.onscroll=function(){g.displayBarrage&&(r(t)?document.getElementsByClassName("comment-barrage")[0].setAttribute("style","display:none;"):document.getElementsByClassName("comment-barrage")[0].setAttribute("style",""))},switchCommentBarrage=function(){if(localStorage.setItem("isBarrageToggle",Number(!Number(localStorage.getItem("isBarrageToggle")))),!r(t)){g.displayBarrage=!g.displayBarrage;let e=document.querySelector(".comment-barrage");e&&$(e).fadeToggle()}"1"==localStorage.getItem("isBarrageToggle")?btf.snackbarShow("✨ 已关闭评论弹幕"):btf.snackbarShow("✨ 已开启评论弹幕")},$(".comment-barrage").hover((function(){null!=timer&&clearInterval(timer)}),(function(){timer=setInterval((()=>{g.barrageList.length&&(o(g.barrageList[g.barrageIndex]),g.barrageIndex+=1,g.barrageIndex%=g.barrageList.length),g.barrageTimer.length>(g.barrageList.length>g.maxBarrage?g.maxBarrage:g.barrageList.length)&&l(g.barrageTimer.shift())}),g.barrageTime)})),null==localStorage.getItem("isBarrageToggle")?localStorage.setItem("isBarrageToggle","0"):"1"==localStorage.getItem("isBarrageToggle")&&(localStorage.setItem("isBarrageToggle","0"),switchCommentBarrage()),e=JSON.stringify({event:"COMMENT_GET","commentBarrageConfig.accessToken":g.accessToken,url:g.pageUrl}),(a=new XMLHttpRequest).withCredentials=!0,a.addEventListener("readystatechange",(function(){4===this.readyState&&(g.barrageList=function(e){e.sort(((e,a)=>e.created-a.created));let a=[];return e.forEach((e=>{a.push(...n(e))})),a}(JSON.parse(this.responseText).data||[]),null!=g.dom&&(g.dom.innerHTML=""))})),a.open("POST",g.twikooUrl),a.setRequestHeader("Content-Type","application/json"),a.send(e),setInterval((()=>{g.barrageList.length&&(o(g.barrageList[g.barrageIndex]),g.barrageIndex+=1,g.barrageIndex%=g.barrageList.length),g.barrageTimer.length>(g.barrageList.length>g.maxBarrage?g.maxBarrage:g.barrageList.length)&&l(g.barrageTimer.shift())}),g.barrageTime)}if(null!=t){function i(){let e=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,a=document.getElementById("switch_commentBarrage"),t=document.getElementById("switch_comment"),r=document.getElementById("chat_btn");e<768?(a.style.display="none",t.style.display="none",r.style.display="none"):(a.style.display="block",t.style.display="block",r.style.display="block")}window.onresize=i,i()}};